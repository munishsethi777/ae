
<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" href="js/jqwidgets/styles/jqx.base.css" type="text/css" />
    <link rel="stylesheet" href="js/jqwidgets/styles/jqx.energyblue.css" type="text/css" />
    <script type="text/javascript" src="js/scripts/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxcore.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxdata.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxbuttons.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxscrollbar.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxmenu.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxgrid.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxgrid.selection.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxgrid.filter.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxlistbox.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxdropdownlist.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxcheckbox.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxwindow.js"></script>
	<script type="text/javascript" src="js/jqwidgets/jqxgrid.pager.js"></script>
	<script type="text/javascript" src="js/jqwidgets/jqxgrid.sort.js"></script>
	<script type="text/javascript" src="js/jqwidgets/jqxgrid.edit.js"></script>
	<script type="text/javascript" src="js/jqwidgets/jqxvalidator.js"></script>
	<script type="text/javascript" src="js/jqwidgets/globalization/globalize.js"></script> 
	<script type="text/javascript" src="js/jqwidgets/jqxcalendar.js"></script> 
	<script type="text/javascript" src="js/jqwidgets/jqxdatetimeinput.js"></script>
    <script type="text/javascript" src="js/jqwidgets/jqxtabs.js"></script>
	
    <script type="text/javascript">
		function generatedata(){
			$.getJSON("AdminUser?action=getAllUsers",function(jsonResponse){
				loadGrid(jsonResponse);
			});
			
		}
		
		
		var beanName = "User";
		
		var validatorRules = [
				{ input: '#nameInput', message: 'Name is required!', action: 'keyup, blur', rule: 'required' },
				{ input: '#usernameInput', message: 'Username is required!', action: 'keyup, blur', rule: 'required' },
				{ input: '#passwordInput', message: 'Password is required!', action: 'keyup, blur', rule: 'required' },
				{ input: '#emailInput', message: 'E-mail is required!', action: 'keyup, blur', rule: 'required' },
				{ input: '#emailInput', message: 'Invalid e-mail!', action: 'keyup', rule: 'email' }];
				
		var columns = [
				{ text: 'ID', datafield: 'id' },
				{ text: 'First Name', datafield: 'name' },
				{ text: 'Mobile', datafield: 'mobile' },
				{ text: 'Location', datafield: 'location' },
				{ text: 'UserName', datafield: 'username'},
				{ text: 'Password', datafield: 'password'},
				{ text: 'Signup Date', datafield: 'createdon'},
				{ text: 'Enabled', datafield: 'isenabled',columntype: 'checkbox'}];
				  
		var dataFields = [
				{ name: 'id', type: 'integer' },
				{ name: 'name', type: 'string' },
				{ name: 'email', type: 'string' },
				{ name: 'mobile', type: 'string' },
				{ name: 'location', type: 'string' },
				{ name: 'username', type: 'string' },
				{ name: 'password', type: 'string' },
				{ name: 'createdon', type: 'date' },
				{ name: 'isenabled', type: 'bool' }];
						
		
										 
		function loadGrid(jsonResponse){
				var theme = "energyblue";
				var getAdapter = function () {
                var data = jsonResponse;
				var source =
					{
                    localdata: data,
                    datatype: "array",
                    datafields:dataFields,
                    updaterow: function (rowid, rowdata, commit) {
                        commit(true);
						$("#jqxCreateBean").jqxWindow('close');
                    },
					addrow: function (rowid, rowdata, position, commit) {
						commit(true);
						$("#jqxCreateBean").jqxWindow('close');
                    },
					deleterow: function (selectedIndexes, commit) {
						commit(true);
                    }
					
                };
                var dataAdapter = new $.jqx.dataAdapter(source);
                return dataAdapter;
            }
			
			$("#jqxGrid").jqxGrid(
            {
                width: 1000,
                source: getAdapter(),
                theme: theme,
                showstatusbar: true,
				pageable: true,
                autoheight: true,
                sortable: true,
                altrows: true,
                enabletooltips: true,
				selectionmode:'multiplerows',
                renderstatusbar: function (statusbar) {
                    var container = $("<div style='overflow: hidden; position: relative; margin: 5px;'></div>");
                    var addButton = $("<div style='float: left; margin-left: 5px;'><img style='position: relative; margin-top: 2px;' src='images/icons/add.png' width='16px' height='16px'/><span style='margin-left: 4px; position: relative; top: -3px;'>Add</span></div>");
                    var deleteButton = $("<div style='float: left; margin-left: 5px;'><img style='position: relative; margin-top: 2px;' src='images/icons/delete.png' width='16px' height='16px'/><span style='margin-left: 4px; position: relative; top: -3px;'>Delete</span></div>");
                    var reloadButton = $("<div style='float: left; margin-left: 5px;'><img style='position: relative; margin-top: 2px;' src='images/icons/refresh.png' width='16px' height='16px'/><span style='margin-left: 4px; position: relative; top: -3px;'>Reload</span></div>");
                    var searchButton = $("<div style='float: left; margin-left: 5px;'><img style='position: relative; margin-top: 2px;' src='images/icons/find.png' width='16px' height='16px'/><span style='margin-left: 4px; position: relative; top: -3px;'>Find</span></div>");
                    container.append(addButton);
                    container.append(deleteButton);
                    container.append(reloadButton);
                    container.append(searchButton);
                    statusbar.append(container);
                    addButton.jqxButton({ theme: theme, width: 60, height: 20 });
                    deleteButton.jqxButton({ theme: theme, width: 65, height: 20 });
                    reloadButton.jqxButton({ theme: theme, width: 65, height: 20 });
                    searchButton.jqxButton({ theme: theme, width: 50, height: 20 });
					
                    // add new row.
                    addButton.click(function (event) {
						$(':input','#createBeanForm')
						 .not(':button, :submit, :reset, :hidden')
						 .val('')
						 .removeAttr('checked')
						 .removeAttr('selected');
						 
                        var offset = $("#jqxGrid").offset();
                        $("#jqxCreateBean").jqxWindow('open');
                        $("#jqxCreateBean").jqxWindow('move', offset.left + 30, offset.top + 30);
						$('#jqxCreateBean').jqxWindow({ title: 'Create New '+ beanName }); 
                    });
                    // delete selected row.
                    deleteButton.click(function (event) {
						var selectedRowIndexes = $('#jqxGrid').jqxGrid('selectedrowindexes');
						var ids = "";
						var i = 0;
						$.each(selectedRowIndexes, function(index , value){
							var dataRow = $("#jqxGrid").jqxGrid('getrowdata', value);
							ids = ids + dataRow.id + ",";
						});
						$.getJSON("AdminUser?action=deleteUser&ids=" + ids,function(json){
							if(json[0]['status'] == 'success'){
								$("#jqxGrid").jqxGrid('deleterow', selectedRowIndexes);
							}
						});
                    });
                    // reload grid data.
                    reloadButton.click(function (event) {
                        $("#jqxGrid").jqxGrid({ source: getAdapter() });
                    });
                    // search for a record.
                    searchButton.click(function (event) {
                    });
                },
									   
                columns: columns
            });
			$('#jqxGrid').on('rowdoubleclick', function (event) 
			{ 
				var args = event.args;
				var rowIndex = args.rowindex;
				var dataRow = $("#jqxGrid").jqxGrid('getrowdata', rowIndex);
				$("#jqxCreateBean #rowIdInput").val(rowIndex);
				$.each(dataFields,function(index,value){
					 $("#jqxCreateBean #"+ value.name +"Input").val(dataRow[value.name]);
				});
				
				var offset = $("#jqxGrid").offset();
				$("#jqxCreateBean").jqxWindow('open');
				$("#jqxCreateBean").jqxWindow('move', offset.left + 30, offset.top + 30);
				$('#jqxCreateBean').jqxWindow({ title: 'Edit '+ beanName }); 
				
			});
			$("#jqxCreateBean").jqxWindow({ resizable: true, theme: theme, autoOpen: false, width: 500, height: 350, showCloseButton: true });
            $("#clearButton").jqxButton({ width: 70, theme: theme });
			$("#saveButton").jqxButton({ width: 70, theme: theme });
            
            if (theme != "") {
                $("#nameInput").addClass('jqx-input-' + theme);
				$("#mobileInput").addClass('jqx-input-' + theme);
				$("#emailInput").addClass('jqx-input-' + theme);
				$("#locationInput").addClass('jqx-input-' + theme);
				$("#usernameInput").addClass('jqx-input-' + theme);
				$("#passwordInput").addClass('jqx-input-' + theme);
            }

			$('#createBeanForm').jqxValidator({
                animationDuration:5,
				rules: validatorRules
			});
			$("#saveButton").click(function () {
				var validationResult = function (isValid) {
					if (isValid) {	
						submitAddRecord();			
					}
				}
				$('#createBeanForm').jqxValidator('validate', validationResult);
			});
			$("#createBeanForm").on('validationSuccess', function () {
				$("#createBeanForm-iframe").fadeIn('fast');
			});
			
		}				 
		
		function submitAddRecord(){
				dataRow = {};
				dataRow['rowId'] = $("#jqxCreateBean #rowIdInput").val();
				$.each(dataFields,function(index,value){
					dataRow[value.name] = $("#jqxCreateBean #"+ value.name +"Input").val();
				});
				$.getJSON("AdminUser?action=addUser",dataRow,function(json){
					if(json['status'] == 'success'){
						if(dataRow['id'] == null || dataRow['id'] == ""){
							dataRow['id'] = json['id'];
							var commit = $("#jqxGrid").jqxGrid('addrow', null, dataRow,true);
						}else{
							var commit = $("#jqxGrid").jqxGrid('updaterow', dataRow['rowId'], dataRow,true);
						}
					}
				});
				
			}
		$(document).ready(function () {
            generatedata();
        });
			
    </script>
</head>
<body class='default'>
	
    <div id='jqxWidget'>
		<label style="font-family:verdana;font-size: 16px;color:black;font-weight:bold">Users Information</label><br>
		<label style="font-family:verdana;font-size: 12px;color:grey">View, Create, Edit, Bulk Delete or Find through various users available in the database.</label>
        <br> <br><div id="jqxGrid">
        </div>
		<div id="jqxCreateBean">
           <div class="title" style="font-weight:bold">Create New User</div>
		   <div style="overflow: hidden;padding:10px;">
				<form id="createBeanForm" name="createBeanForm" method="POST"/>
					<input type="hidden" name="rowId" id="rowIdInput"/>
					<input type="hidden" name="id" id="idInput"/>
					<input type="hidden" name="createdon" id="createdonInput"/>
					<table style="overflow: hidden;">
					<tr>
						<td>Name</td>
						<td><input name="name" type="text" id="nameInput"/></td>
					</tr>
					<tr>
						<td>Mobile</td>
						<td><input name="mobile" type="text" id="mobileInput"/></td>
					</tr>
					<tr>
						<td>E-Mail</td>
						<td><input name="email" type="text" id="emailInput"/></td>
					</tr>
					<tr>
						<td>Location</td>
						<td><input name="location" type="text" id="locationInput"/></td>
					</tr>
					<tr>
						<td>Username</td>
						<td><input name="username" type="text" id="usernameInput"/></td>
					</tr>
					<tr>
						<td>Password</td>
						<td><input name="password" type="text" id="passwordInput"/></td>
					</tr>
					<tr>
						<td>Enabled</td>
						<td><input name="enabled" type="checkbox" id="enabledInput"/></td>
					</tr>
					<tr>
						<td><input type="button" style='margin-top: 15px; margin-left: 50px; float: left;' value="Save" id="saveButton" /></td>
						<td><input type="button" style='margin-left: 5px; margin-top: 15px; float: left;' value="Clear" id="clearButton" /></td>
					</tr>
				</table>
				</form>
           </div>
		</div>
		
	
	
	</div>
</body>
</html>
